{% extends "_layout.html" %}

{% block content %}


<input type="file" onchange="previewFile()"><br>
<img src="" height="20px" alt="Image preview...">



{% endblock %}

{% block js_script %}

<script type="text/javascript">
    function previewFile() {
        const preview = document.querySelector('img');
        const file = document.querySelector('input[type=file]').files[0];
        const reader = new FileReader();
        reader.addEventListener("load", function () {
            preview.src = reader.result; //show image in <img tag>
            base64String = reader.result.replace("data:", "").replace(/^.+,/, "");
            console.log("preview.src=")
            console.log(preview.src)
            console.log("base64String=")
            console.log(base64String)

            uploadFile(file.name, base64String)
        }, false);

        if (file) {
            reader.readAsDataURL(file);
        }
    }

    function uploadFile(filename, filedata) {
        var formData = new FormData();
        formData.append("filename", filename);
        formData.append("filedata", filedata);
        fetch('/provo/upload', {
            method: 'POST',
            body: formData,
        })
            .then(response => {
                console.log(response);
            })
            .catch(error => {
                console.error(error);
            });
    }

</script>


{% endblock %}

